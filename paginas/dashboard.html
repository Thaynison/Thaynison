<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="icon" href="../imgs/logo.png" type="image/png">
    <script>
        const token = getTokenFromURL();
        getUserData(token);

        function getTokenFromURL() {
            const params = new URLSearchParams(window.location.hash.substr(1));
            return params.get('access_token');
        }

        function getUserData(token) {
            axios.get('https://discord.com/api/users/@me', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                const userData = response.data;
                document.getElementById('username').textContent = userData.username;
                document.getElementById('userid').textContent = userData.id;
            })
            .catch(error => {
                console.error(error);
            });
        }
    </script>
</head>
<body>
    <header>
        <div class="txt">
            <h1>Dashboard</h1>
        </div>
        <div id="user-info" class="infors">
            <h2>Olá, <span id="username"></span>!</h2>
            <h2 style="display: none;">Olá, <span id="userid"></span>!</h2>
            <a href="../index.html"><img src="../imgs/saida.png" alt=""></a>
        </div>        
    </header>
    <main>
        <button onclick="redirecionarParaLoja()">Loja</button>
        <button onclick="redirecionarParaPainel()">Painel</button>
        <script>
            function redirecionarParaLoja() {
                const username = document.getElementById('username').textContent;
                const userid = document.getElementById('userid').textContent;
                // window.location.href = `loja.html?username=${encodeURIComponent(username)}`;
                window.location.href = `loja.html?username=${encodeURIComponent(username)}&userid=${encodeURIComponent(userid)}`;
            }
            function redirecionarParaPainel() {
                const username = document.getElementById('username').textContent;
                const userid = document.getElementById('userid').textContent;
                
                const allowedUserIds = ['302921790185799682']; // Insira os userids permitidos aqui
                
                if (allowedUserIds.includes(userid)) {
                    window.location.href = `painel.html?username=${encodeURIComponent(username)}&userid=${encodeURIComponent(userid)}`;
                } else {
                    alert('Acesso não autorizado!');
                    // Ou redirecione para outra página, exiba uma mensagem de erro, etc.
                }
            }
        </script>
    </main>
</body>
</html>
